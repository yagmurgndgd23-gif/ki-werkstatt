<!doctype html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KI-Wand der Erkenntnisse</title>

    <style>
        :root{
            /* === DARK BACKGROUND === */
            --bg0:#0e0f12;
            --bg1:#15171c;

            /* === WHITE CARD LOOK === */
            --card:#ffffff;
            --card2:#f7f7f9;
            --stroke:rgba(0,0,0,0.12);
            --shadow:0 14px 40px rgba(0,0,0,0.35);

            /* Text */
            --ink:#0f1115;
            --muted:#4b5563;
            --link:#4a1c7a;

            /* Accent (violett) */
            --accent1:#7c3aed;
            --accent2:#a855f7;

            /* Pills */
            --pill-bg:rgba(124,58,237,0.10);
            --pill-border:rgba(124,58,237,0.22);

            /* Wall */
            --wall-dash:rgba(0,0,0,0.18);

            /* Notes */
            --note-bg:rgba(255, 250, 170, 0.92);
            --note-border:rgba(160, 130, 20, 0.35);
        }

        *{ box-sizing:border-box; }

        html, body{
            margin:0;
            padding:0;
            font-family: Arial, sans-serif;
            background:
                    radial-gradient(circle at top, rgba(255,255,255,0.06), rgba(255,255,255,0.00) 55%),
                    linear-gradient(180deg, var(--bg0), var(--bg1));
        }

        body{
            min-height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            padding:26px;
        }

        .wrap{
            width:min(1100px, 95vw);
            display:grid;
            gap:14px;
        }

        .card{
            background: rgba(255,255,255,0.95);
            border-radius:18px;
            padding:20px;
            box-shadow: var(--shadow);
            border:1px solid rgba(255,255,255,0.10);
            backdrop-filter: blur(8px);
        }

        h2{
            margin:0 0 10px 0;
            font-size:28px;
            color:var(--ink);
        }
        p{
            margin:0;
            line-height:1.6;
            color:var(--muted);
        }

        .bubble-row{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            margin-top:14px;
            align-items:center;
        }

        .bubble{
            cursor:pointer;
            border:none;
            border-radius:999px;
            padding:10px 14px;
            font-weight:800;
            font-size:13px;
            color:white;
            background: linear-gradient(135deg, var(--accent1), var(--accent2));
            box-shadow: 0 10px 22px rgba(0,0,0,0.18);
            transition: filter 0.12s ease, transform 0.12s ease;
        }
        .bubble:hover{ filter:brightness(1.05); transform: translateY(-1px); }
        .bubble.active{
            outline: 3px solid rgba(0,0,0,0.10);
            box-shadow: inset 0 0 0 2px rgba(124,58,237,0.25);
        }

        .input-row{
            display:grid;
            grid-template-columns: 1fr auto auto auto;
            gap:10px;
            margin-top:12px;
            align-items:center;
        }

        textarea{
            width:100%;
            min-height:52px;
            resize:vertical;
            border-radius:14px;
            border:1px solid rgba(0,0,0,0.14);
            background: rgba(255,255,255,0.96);
            padding:12px;
            font-family: Arial, sans-serif;
            font-size:14px;
            line-height:1.4;
            box-shadow: 0 10px 22px rgba(0,0,0,0.10);
            outline:none;
            color:var(--ink);
        }
        textarea:focus{
            border-color: rgba(124,58,237,0.50);
            box-shadow: 0 10px 22px rgba(0,0,0,0.14);
        }

        button.action{
            border:none;
            cursor:pointer;
            border-radius:999px;
            padding:10px 14px;
            font-weight:900;
            background: linear-gradient(135deg, var(--accent1), var(--accent2));
            color:white;
            box-shadow: 0 10px 22px rgba(0,0,0,0.18);
            transition: filter 0.12s ease, transform 0.12s ease, opacity 0.12s ease;
            white-space:nowrap;
        }
        button.action:hover{ filter:brightness(1.05); transform: translateY(-1px); }

        button.secondary{
            background: rgba(255,255,255,0.96);
            color:#111827;
            border:1px solid rgba(0,0,0,0.14);
            box-shadow: 0 10px 22px rgba(0,0,0,0.10);
        }

        button.action:disabled{
            opacity:0.55;
            cursor:not-allowed;
            transform:none;
            filter:none;
        }

        .status-row{
            margin-top:10px;
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            align-items:center;
            font-size:13px;
            opacity:0.95;
            color:var(--muted);
        }
        .pill{
            background: var(--pill-bg);
            border:1px solid var(--pill-border);
            padding:6px 10px;
            border-radius:999px;
            color:#111827;
        }

        .typing{ display:none; }
        .typing.on{
            display:inline-flex;
            align-items:center;
            gap:8px;
        }
        .dots{ display:inline-flex; gap:3px; }
        .dot{
            width:6px; height:6px;
            border-radius:50%;
            background: rgba(17,24,39,0.55);
            animation: blink 1s infinite ease-in-out;
        }
        .dot:nth-child(2){ animation-delay: 0.15s; }
        .dot:nth-child(3){ animation-delay: 0.30s; }
        @keyframes blink{
            0%, 100% { transform: translateY(0); opacity:0.45; }
            50% { transform: translateY(-2px); opacity:1; }
        }

        /* --- WALL --- */
        .wall{
            margin-top:14px;
            height:540px;
            border-radius:16px;
            border:2px dashed var(--wall-dash);

            background:
                    radial-gradient(circle at 20% 20%, rgba(0,0,0,0.02), rgba(255,255,255,0.00)),
                    repeating-linear-gradient(45deg, rgba(0,0,0,0.04), rgba(0,0,0,0.04) 10px, rgba(255,255,255,0.00) 10px, rgba(255,255,255,0.00) 20px);

            box-shadow:
                    inset 0 0 0 1px rgba(0,0,0,0.10),
                    0 12px 28px rgba(0,0,0,0.10);

            position:relative;
            overflow:hidden;
            padding:12px;
            cursor: default;
            transition: box-shadow 0.12s ease, outline-color 0.12s ease, transform .12s ease;
        }
        .wall:hover{
            box-shadow:
                    inset 0 0 0 2px rgba(0,0,0,0.12),
                    0 16px 34px rgba(0,0,0,0.14);
            transform: translateY(-1px);
        }

        .wall.armed{
            outline: 3px solid rgba(124,58,237,0.35);
            outline-offset: 2px;
        }

        .postit{
            position:absolute;
            width:240px;
            background: var(--note-bg);
            border:1px solid var(--note-border);
            border-radius:12px;
            padding:10px;
            box-shadow: 0 10px 22px rgba(0,0,0,0.18);
            transform: rotate(var(--rot));
            cursor:pointer;
            user-select:none;
            transition: transform 0.1s;
            color:#111;
        }
        .postit:hover{ transform: scale(1.05) rotate(0deg); z-index:100; }
        .postit b{ display:block; margin-bottom:6px; color:#000; }

        .hint{
            margin-top:10px;
            font-size:13px;
            opacity:0.9;
            color:var(--muted);
        }

        .links{
            margin-top:12px;
            display:flex;
            gap:14px;
            flex-wrap:wrap;
            align-items:center;
        }
        a.link{
            text-decoration:none;
            font-weight:bold;
            color:var(--link);
        }
        a.link:hover{ text-decoration: underline; }

        @media (max-width: 900px){
            .input-row{ grid-template-columns: 1fr; }
            .wall{ height:520px; }
        }
    </style>
</head>

<body>
<div class="wrap">
    <div class="card">
        <h2>‚≠ê KI-Wand der Erkenntnisse</h2>
        <p>Schreibe deinen Text. Wir haben ‚ÄûIdee‚Äú vor-ausgew√§hlt, damit du sofort loslegen kannst.</p>

        <div class="bubble-row">
            <button class="bubble" data-title="Gelernt:" data-placeholder="Eine Sache, die ich gelernt habe‚Ä¶">üß† Gelernt</button>
            <button class="bubble" data-title="Regel:" data-placeholder="Eine Regel f√ºr gesunde KI-Nutzung‚Ä¶">üìè Regel</button>
            <button class="bubble" data-title="Idee:" data-placeholder="Eine kreative Idee, die mir die KI-Werkstatt gegeben hat‚Ä¶">‚ú® Idee</button>
        </div>

        <div class="input-row">
            <textarea id="textInput" placeholder="Tippe hier deine Idee..."></textarea>

            <button class="action" id="placeMode" type="button" aria-pressed="false" title="Aktiviert den Platzieren-Modus">
                üìå Platzieren
            </button>

            <button class="action secondary" id="undo" type="button" disabled title="Macht den letzten Schritt r√ºckg√§ngig">
                ‚Ü©Ô∏è R√ºckg√§ngig
            </button>

            <button class="action secondary" id="reset" type="button" title="Leert die Wand (optional)">
                üßπ Wand leeren
            </button>
        </div>

        <div class="status-row" aria-live="polite">
            <span class="pill" id="modePill">Modus: Normal</span>
            <span class="pill" id="countPill">Notizen: 0</span>
            <span class="pill typing" id="typingPill">
                KI tippt
                <span class="dots" aria-hidden="true">
                    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </span>
            </span>
        </div>

        <div class="wall" id="wall" aria-label="Erkenntnis-Wand" title="Hier werden Notizen platziert"></div>

        <div class="hint">
            Hinweis: Klick auf eine Notiz = l√∂schen. Es wird nichts gespeichert (nur Demo).
        </div>

        <div class="links">
            <a class="link" href="yara_aufgabe.html">‚Üê Zur√ºck zu Yara</a>
            <button class="action secondary" type="button" onclick="window.location.href='index.html'">
                üè† Zur√ºck zum Start
            </button>
        </div>
    </div>
</div>

<script>
    const bubbles = document.querySelectorAll(".bubble");
    const textInput = document.getElementById("textInput");
    const wall = document.getElementById("wall");

    const resetBtn = document.getElementById("reset");
    const undoBtn  = document.getElementById("undo");
    const placeBtn = document.getElementById("placeMode");

    const modePill  = document.getElementById("modePill");
    const countPill = document.getElementById("countPill");
    const typingPill = document.getElementById("typingPill");

    let active = null;
    let placeArmed = false;

    const undoStack = [];

    function updateUI(){
        const count = wall.querySelectorAll(".postit").length;
        countPill.textContent = "Notizen: " + count;
        undoBtn.disabled = undoStack.length === 0;
        modePill.textContent = placeArmed ? "Modus: Platzieren aktiv" : "Modus: Normal";
    }

    function setPlaceMode(on){
        placeArmed = on;
        wall.classList.toggle("armed", on);
        wall.style.cursor = on ? "crosshair" : "default";
        placeBtn.setAttribute("aria-pressed", String(on));
        placeBtn.textContent = on ? "üìå Platzieren (aktiv)" : "üìå Platzieren";
        updateUI();
    }

    function showTyping(ms=450){
        typingPill.classList.add("on");
        return new Promise(res => setTimeout(() => {
            typingPill.classList.remove("on");
            res();
        }, ms));
    }

    bubbles.forEach(b => {
        b.addEventListener("click", () => {
            bubbles.forEach(x => x.classList.remove("active"));
            b.classList.add("active");
            active = { title: b.dataset.title, placeholder: b.dataset.placeholder };
            textInput.placeholder = active.placeholder;
            textInput.focus();
        });
    });

    const defaultBubble = document.querySelector('.bubble[data-title="Idee:"]');
    if(defaultBubble) defaultBubble.click();

    placeBtn.addEventListener("click", () => {
        if(!placeArmed){
            if (!active) return alert("Bitte w√§hle eine Kategorie (Bubble).");
            if (!textInput.value.trim()) { alert("Bitte einen Text eingeben."); textInput.focus(); return; }
            setPlaceMode(true);
        } else {
            setPlaceMode(false);
        }
    });

    wall.addEventListener("click", async (e) => {
        if (!placeArmed || !active) return;

        const txt = textInput.value.trim();
        if (!txt) return;

        await showTyping(450);

        const rect = wall.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const note = document.createElement("div");
        note.className = "postit";

        const rot = (Math.random() * 10 - 5).toFixed(1) + "deg";
        note.style.setProperty("--rot", rot);

        const w = 240;
        const h = 130;
        const left = Math.max(10, Math.min(x - w/2, rect.width - w - 10));
        const top  = Math.max(10, Math.min(y - 30, rect.height - h - 10));

        note.style.left = left + "px";
        note.style.top  = top + "px";
        note.innerHTML = "<b>" + active.title + "</b>" + escapeHtml(txt);

        note.addEventListener("click", (ev) => {
            ev.stopPropagation();

            const snap = {
                left: note.style.left,
                top: note.style.top,
                rot: note.style.getPropertyValue("--rot"),
                html: note.innerHTML
            };

            note.remove();

            undoStack.push(() => {
                const restored = document.createElement("div");
                restored.className = "postit";
                restored.style.left = snap.left;
                restored.style.top = snap.top;
                restored.style.setProperty("--rot", snap.rot);
                restored.innerHTML = snap.html;

                restored.addEventListener("click", (ev2) => {
                    ev2.stopPropagation();
                    restored.remove();
                    undoStack.push(() => { wall.appendChild(restored); updateUI(); });
                    updateUI();
                });

                wall.appendChild(restored);
                updateUI();
            });

            updateUI();
        });

        undoStack.push(() => {
            if(note.parentNode) note.remove();
            updateUI();
        });

        wall.appendChild(note);

        setPlaceMode(false);
        textInput.value = "";
        textInput.focus();
        updateUI();
    });

    undoBtn.addEventListener("click", () => {
        const action = undoStack.pop();
        if(action) action();
        updateUI();
    });

    resetBtn.addEventListener("click", () => {
        const notes = Array.from(wall.querySelectorAll(".postit"));
        if(notes.length === 0) return;

        const snapshot = notes.map(n => ({
            left: n.style.left,
            top: n.style.top,
            rot: n.style.getPropertyValue("--rot"),
            html: n.innerHTML
        }));

        undoStack.push(() => {
            snapshot.forEach(s => {
                const restored = document.createElement("div");
                restored.className = "postit";
                restored.style.left = s.left;
                restored.style.top = s.top;
                restored.style.setProperty("--rot", s.rot);
                restored.innerHTML = s.html;
                restored.addEventListener("click", (ev) => { ev.stopPropagation(); restored.remove(); updateUI(); });
                wall.appendChild(restored);
            });
            updateUI();
        });

        wall.innerHTML = "";
        textInput.value = "";
        setPlaceMode(false);
        if(defaultBubble) defaultBubble.click();
        updateUI();
    });

    document.addEventListener("keydown", (e) => {
        if(e.key === "Escape" && placeArmed) setPlaceMode(false);
    });

    function escapeHtml(str){
        return str
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;")
            .replaceAll("\n", "<br>");
    }

    setPlaceMode(false);
    updateUI();
</script>
</body>
</html>
